{% extends "base.html" %}

{% block title %}Generate Recipe{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-5">
        <h3>Generate a New Recipe</h3>
        <form id="recipe-form">
            <div class="mb-3">
                <label for="ingredients" class="form-label">Ingredients (one per line or comma-separated)</label>
                <textarea class="form-control" id="ingredients" name="ingredients" rows="5" placeholder="e.g., chicken breast, broccoli, soy sauce, ginger"></textarea>
            </div>
            <div class="mb-3">
                <label for="description" class="form-label">Description / Special Requests</label>
                <textarea class="form-control" id="description" name="description" rows="3" placeholder="e.g., Looking for a quick weeknight dinner. Make it spicy!"></textarea>
            </div>
            <div class="mb-3">
                <label for="diet" class="form-label">Dietary Preference (Optional)</label>
                <select class="form-select" id="diet" name="diet">
                    <option value="">Any</option>
                    <option value="vegetarian">Vegetarian</option>
                    <option value="vegan">Vegan</option>
                    <option value="gluten-free">Gluten-Free</option>
                    </select>
            </div>
            <div class="mb-3">
                <label for="cuisine" class="form-label">Cuisine Style (Optional)</label>
                <input type="text" class="form-control" id="cuisine" name="cuisine" placeholder="e.g., Italian, Thai, Mexican">
            </div>
            <button type="submit" id="generate-btn" class="btn btn-success">Generate Recipe</button>
            <div id="loading-indicator" class="spinner-border text-success ms-2" role="status" style="display: none;">
                <span class="visually-hidden">Loading...</span>
            </div>
        </form>

        <div id="shopping-list-section" class="mt-5">
            <hr> <h3 class="mb-3">Shopping List</h3>

            <div class="input-group mb-3">
                <input type="text" id="manual-add-item" class="form-control" placeholder="Manually add item">
                <button id="manual-add-btn" class="btn btn-outline-secondary" type="button">Add</button>
            </div>

            <div id="shopping-list-items" class="mb-3">
                <p><em>Your shopping list is empty. Add items from a recipe or manually.</em></p>
            </div>

            <div class="d-flex justify-content-between">
                 <button id="copy-list-btn" class="btn btn-sm btn-info">Copy List</button>
                 <button id="clear-list-btn" class="btn btn-sm btn-danger">Clear All</button>
            </div>
             <textarea id="copy-list-textarea" aria-hidden="true" style="position: absolute; left: -9999px; top: -9999px; opacity: 0;"></textarea> </div>
        </div>

    <div class="col-md-7">
        <h3>Generated Recipe</h3>
        <div id="recipe-output" class="mt-3 p-3 border rounded bg-light" style="min-height: 200px;">
            <p>Enter your ingredients and preferences, then click "Generate Recipe".</p>
        </div>
        <div id="recipe-actions" class="mt-2" style="display: none;">
            <button id="add-to-list-btn" class="btn btn-sm btn-primary">Add Ingredients to Shopping List</button>
            </div>
        <div id="substitution-output" class="mt-3"></div>
    </div>
</div>

{% if shared_recipe %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Ensure the displayRecipe function is accessible, perhaps make it global in script.js
        if (typeof displayRecipe === 'function') {
             const recipeData = JSON.parse('{{ shared_recipe | tojson | escapejs }}'); // Safely inject JSON
             displayRecipe(recipeData);
        } else {
            console.error("displayRecipe function not found. Cannot display shared recipe.");
        }
    });
</script>
{% endif %}

{% endblock %}
